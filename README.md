# Admate

ç®¡ç†åå°ä¼´ä¾£ï¼Œç”¨ç®€æ´è€Œä¸å¤±çµæ´»çš„æ–¹å¼å¼€å‘ç®¡ç†åå°é¡µé¢ï¼Œå¯ä»¥é›†æˆè¿›ä»»æ„ç®¡ç†åå°æ¡†æ¶å¦‚ [vue-vben-admin](https://github.com/anncwb/vue-vben-admin)
, [vue-element-admin](https://github.com/PanJiaChen/vue-element-admin) ä¸­ã€‚

åå°é¡µé¢çš„ç‰¹ç‚¹æ˜¯é‡å¤åº¦é«˜ï¼Œå¦‚æœæå–å…¬å…±ä»£ç åˆéš¾ä»¥æ»¡è¶³å®šåˆ¶åŒ–éœ€æ±‚ï¼ŒAdmate è‡´åŠ›äºè§£å†³è¿™ä¸€ç—›ç‚¹ã€‚

![æˆ‘å…¨éƒ½è¦](https://raw.githubusercontent.com/cloydlau/admate/master/æˆ‘å…¨éƒ½è¦.gif)

| æ¡ˆä¾‹å¯¹æ¯”                                                                                                          | æŠ€æœ¯æ ˆ                         |                                  ä¸šåŠ¡ä»£ç é‡ï¼ˆå­—ç¬¦æ•°ï¼‰                                   |
| ----------------------------------------------------------------------------------------------------------------- | ------------------------------ | :-------------------------------------------------------------------------------------: |
| [å¸¸è§„å¢åˆ æŸ¥æ”¹é¡µé¢](https://github.com/PanJiaChen/vue-element-admin/blob/master/src/views/table/complex-table.vue) | Vue 2 + ElementUI              |                                         13,330                                          |
| å¸¸è§„å¢åˆ æŸ¥æ”¹é¡µé¢                                                                                                  | Vue 2 + ElementUI + **Admate** |                                      **çº¦ 5,000**                                       |
| å¯¹æ¥[æ”¯ä»˜å®è¿›ä»¶](https://opendocs.alipay.com/pre-apis/00a8e3)                                                     | Vue 2 + ElementUI              |   89,293<br><span style="color:rgba(28,31,35,.6);font-size:12px;">ï¼ˆè¡¨å•éƒ¨åˆ†ï¼‰</span>   |
| å¯¹æ¥[å¾®ä¿¡è¿›ä»¶](https://pay.weixin.qq.com/wiki/doc/apiv3_partner/apis/chapter7_1_1.shtml)                          | Vue 2 + ElementUI + **Admate** | **38,718**<br><span style="color:rgba(28,31,35,.6);font-size:12px;">ï¼ˆè¡¨å•éƒ¨åˆ†ï¼‰</span> |
| ç”µå•†åå°çš„å•†å“ç®¡ç†                                                                                                | Vue 2 + ElementUI              |                                         425,885                                         |
| ç”µå•†åå°çš„å•†å“ç®¡ç†ï¼ˆé‡æ„åï¼‰                                                                                      | Vue 2 + ElementUI + **Admate** |                                       **235,979**                                       |

<br>

## ç‰¹æ€§

- ğŸ•¶ **Vue 2 & 3 é€šç”¨** - é›¶æˆæœ¬å‡çº§
- ğŸ¤ **ä¸é™åˆ¶ UI æ¡†æ¶** - åªè¦æŠ€æœ¯æ ˆæ˜¯ Vue + Axios ä¾¿å¯ä½¿ç”¨ï¼Œæä¾›ä¸»æµ UI æ¡†æ¶ç¤ºä¾‹ä»£ç ï¼ˆVuetifyï¼ŒElementï¼ŒAntDesignVueï¼ŒQuasarï¼ŒPrimeVueï¼‰
- ğŸª **ä»£ç†æ¨¡å¼ + æ§åˆ¶åè½¬** - ä½¿ç”¨é’©å­å‡½æ•°çš„ä»£ç†æ¥é‡èº«æ‰“é€ ç”Ÿå‘½å‘¨æœŸçš„è¡Œä¸º
- ğŸŒ **æä¾›æ¨¡å—çº§çš„è¯·æ±‚é…ç½®** - è™½ç„¶ Axios æ”¯æŒå…¨å±€é…ç½®ï¼Œç”±äºåŒæ¨¡å—å†…è¯·æ±‚é…ç½®ç›¸ä¼¼ï¼Œæ¥å£å‰ç¼€é€šå¸¸æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¾€å¾€è¿˜éœ€è¦æ¨¡å—çº§åˆ«çš„é…ç½®
- ğŸª **è´´å¿ƒè€Œä¸æ­¦æ–­çš„ CRUD å°è£…**
    - åˆ—è¡¨ç­›é€‰ï¼šæ”¯æŒç›‘å¬ç­›é€‰å‚æ•° + é˜²æŠ–æ§åˆ¶æ¥å£è°ƒç”¨é¢‘ç‡çš„æ–¹å¼ï¼Œä¹Ÿæ”¯æŒç‚¹å‡»æŸ¥è¯¢æŒ‰é’®è§¦å‘çš„æ–¹å¼
    - è¡¨å•å±•ç°å½¢å¼ï¼šæ”¯æŒå¯¹è¯æ¡†çš„å½¢å¼ï¼Œä¹Ÿæ”¯æŒç‹¬ç«‹é¡µé¢çš„å½¢å¼
    - å•æ¡è®°å½•çŠ¶æ€ï¼šæ”¯æŒåˆ†åˆ«è°ƒç”¨å¯ç”¨/åœç”¨æ¥å£æ”¹å˜çŠ¶æ€ï¼Œä¹Ÿæ”¯æŒè°ƒç”¨ç»Ÿä¸€çš„æ›´æ–°çŠ¶æ€æ¥å£æŒ‡å®šæ–°çŠ¶æ€
    - åŠ è½½çŠ¶æ€ï¼šæä¾›åˆ—è¡¨è¯»å–çŠ¶æ€ã€è¡¨å•è¯»å–çŠ¶æ€ã€è¡¨å•æäº¤çŠ¶æ€çš„å“åº”å¼å˜é‡
- ğŸ§¹ **å‘¨å…¨çš„æ”¶å°¾å·¥ä½œï¼Œæ²¡æœ‰â€œåé¡¾ä¹‹å¿§â€**
    - å…³é—­è¡¨å•æ—¶ï¼Œè‡ªåŠ¨å°†è¡¨å•ç»‘å®šçš„æ•°æ®æ¢å¤è‡³åˆå§‹çŠ¶æ€ï¼ˆä¸æ˜¯ç›´æ¥æ¸…ç©ºï¼‰
    - åˆ é™¤å½“å‰åˆ†é¡µæœ€åä¸€æ¡è®°å½•æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢è‡³ä¸Šä¸€é¡µï¼ˆå¦‚æœå½“å‰ä¸åœ¨ç¬¬ä¸€é¡µï¼‰
- ğŸ”Œ **æä¾›[é€‚é…å±‚ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/useAdmateAdapter.ts)**
  - æ”¯æŒ URL ä¼ å‚æŒ‡å®šç­›é€‰é¡¹é»˜è®¤å€¼
  - æ”¯æŒåŠ¨æ€ç”Ÿæˆç­›é€‰é¡¹é»˜è®¤å€¼ï¼Œä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ï¼šæ—¥æœŸ/æ—¶é—´ç±»çš„å‚æ•°ï¼Œå¦‚æœå…¶é»˜è®¤å€¼ä¸ºå½“å‰æœ€æ–°æ—¶åˆ»ï¼Œé‡ç½®ç­›é€‰é¡¹æ—¶ä¼šé‡ç½®åˆ°å·²è¿‡æœŸçš„æ—¶åˆ»
  - è‡ªå®šä¹‰é’©å­å‡½æ•°ï¼šè·å–åˆ—è¡¨å / æ‰“å¼€è¡¨å•å / æŸ¥è¯¢è¡¨å•å / æäº¤è¡¨å•å‰
  - åˆ—è¡¨ç­›é€‰å‚æ•°æ ¡éªŒ
  - åˆ—è¡¨ç­›é€‰å‚æ•°é‡ç½®

<br>

## æ¶æ„

![æ¶æ„å›¾](https://raw.githubusercontent.com/cloydlau/admate/master/architecture-diagram.png)

<br>

## å®‰è£…

![NPM](https://nodei.co/npm/admate.png)

### Vue 3

```bash
npm add admate
```

<br>

### Vue 2

```bash
# vue@2.6 æˆ–æ›´æ—©ç‰ˆæœ¬éœ€è¦é¢å¤–å®‰è£… @vue/composition-api
npm add admate
```

<br>

### é¡µé¢æ¨¡æ¿

> æ­é…äº† [kikimore](https://www.npmjs.com/package/kikimore)

1. å°† [vscode-code-snippets](https://github.com/cloydlau/vscode-code-snippets) ä¸­çš„ `*.code-snippets` æ–‡ä»¶æ‹·è´è‡³ `C:\Users\admin\AppData\Roaming\Code\User\snippets`
2. ä½¿ç”¨æ–¹æ³•ï¼šè¾“å…¥ä»¥ä¸‹å…³é”®è¯ï¼Œç„¶åæŒ‰ Tabï¼š
   - `admate`: admate é¡µé¢æ¨¡æ¿
   - `admate:form-only`: admate é¡µé¢æ¨¡æ¿ï¼ˆåªæœ‰è¡¨å•æ²¡æœ‰åˆ—è¡¨çš„åœºæ™¯ï¼‰
   - `KiFormDialog`: KiFormDialog ç»„ä»¶
   - `KiFormDialog.data`: KiFormDialog ç»„ä»¶çš„ data
   - `KiFormDialog:readonly`: KiFormDialog ç»„ä»¶ï¼ˆåªè¯»æ¨¡å¼ï¼‰
   - `KiFormDialog.data:readonly`: KiFormDialog ç»„ä»¶çš„ dataï¼ˆåªè¯»æ¨¡å¼ï¼‰
   - `KiSelect:options`: KiSelect ç»„ä»¶ï¼Œæœ¬åœ°æ•°æ®æº
   - `KiSelect:search`: KiSelect ç»„ä»¶ï¼Œè¿œç¨‹æ•°æ®æº
   - `KiSelect:index`: KiSelect ç»„ä»¶ï¼Œç»‘å®šå€¼ä¸ºæ•°ç»„ä¸‹æ ‡
   - `:props`: KiSelect ç»„ä»¶çš„ props å‚æ•°
   - `:options`: KiSelect ç»„ä»¶çš„ options å‚æ•°
   - `:search`: KiSelect ç»„ä»¶çš„ search å‚æ•°

<br>

### ä»£ç ç”Ÿæˆå™¨

æ¥å£æ–‡æ¡£ä¸€é”®ç”Ÿæˆé¡µé¢æ¨¡æ¿ä»£ç ï¼Œçœå»**ä»æ¥å£æ–‡æ¡£å¤åˆ¶å­—æ®µåè‡³ä»£ç ä¸­**è¿™ä¸€ç¹çæ­¥éª¤

ç›®å‰ä»…æ”¯æŒ YApi + element-ui

#### å®‰è£…

å®‰è£… Chrome / Edge æ’ä»¶ **YApi2Code**ï¼Œæˆ–ä½¿ç”¨ç¦»çº¿ç‰ˆï¼š

1. <a href="https://github.com/cloydlau/yapi2code-crx/blob/master/yapi2code-crx.zip?raw=true" download>ä¸‹è½½ç¦»çº¿åŒ…</a>åè§£å‹

2. æ‰“å¼€æµè§ˆå™¨**æ‰©å±•ç¨‹åº**ï¼Œå¹¶å¼€å¯**å¼€å‘è€…æ¨¡å¼**

3. ç‚¹å‡»**åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº**ï¼Œé€‰æ‹©è§£å‹åçš„æ–‡ä»¶å¤¹

#### ä½¿ç”¨

1. è®¿é—® YApiï¼Œé€‰ä¸­ç›¸åº”æ¨¡å—çš„**æŸ¥è¯¢åˆ—è¡¨**æ¥å£

2. ç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’è¿è¡Œæ’ä»¶

3. ç‚¹å‡»**ç”Ÿæˆä»£ç **ï¼Œä»£ç å°†è¢«å¤åˆ¶è‡³å‰ªè´´æ¿

4. åˆ›å»ºé¡µé¢æ–‡ä»¶ `xxx.vue`ï¼Œç²˜è´´ä»£ç 

<br>

### æ­é… Vuetify

<img src="https://img.shields.io/npm/dm/vuetify.svg"> <img src="https://img.shields.io/github/stars/vuetifyjs/vuetify">

[Vuetify@3 ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/UseUIFramework/Vuetify.vue) 

[Vuetify@2 ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue2/UseUIFramework/Vuetify.vue)

<br>

### æ­é… ElementUI

<img src="https://img.shields.io/npm/dm/element-ui.svg"> <img src="https://img.shields.io/github/stars/ElemeFE/element">

[ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue2/UseUIFramework/ElementUI.vue)

<br>

### æ­é… ElementPlus

<img src="https://img.shields.io/npm/dm/element-plus.svg"> <img src="https://img.shields.io/github/stars/element-plus/element-plus">

[ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/UseUIFramework/ElementPlus.vue)

<br>

### æ­é… AntDesignVue

<img src="https://img.shields.io/npm/dm/ant-design-vue.svg"> <img src="https://img.shields.io/github/stars/vueComponent/ant-design-vue">

[AntDesignVue@2 ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/UseUIFramework/AntDesignVue.vue)

[AntDesignVue@1 ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue2/UseUIFramework/AntDesignVue.vue)

<br>

### æ­é… Quasar

<img src="https://img.shields.io/npm/dm/quasar.svg"> <img src="https://img.shields.io/github/stars/quasarframework/quasar">

[Quasar@2 ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/UseUIFramework/Quasar.vue)

Quasar@1ï¼ˆåº”è¯¥ï¼‰ä¸æ”¯æŒ Viteï¼Œæš‚æ— ç¤ºä¾‹

<br>

### æ­é… PrimeVue

<img src="https://img.shields.io/npm/dm/primevue.svg"> <img src="https://img.shields.io/github/stars/primefaces/primevue">

[PrimeVue@3 ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/UseUIFramework/PrimeVue.vue)

PrimeVue@2ï¼ˆåº”è¯¥ï¼‰ä¸æ”¯æŒ Viteï¼Œæš‚æ— ç¤ºä¾‹

<br>

## è¯·æ±‚é…ç½®

### axios

```ts
useAdmate({
  // Axios æˆ– Axios å®ä¾‹
  // ç”¨äºè°ƒç”¨æ¥å£
  axios,
})
```

<br>

### axiosConfig

```ts
useAdmate({
  // Axios é…ç½®
  axiosConfig: {
    // æŸ¥è¯¢åˆ—è¡¨
    getList: {
      method: 'GET',
    },
    // æ–°å¢ä¸€æ¡è®°å½•ï¼ˆsubmitForm åœ¨æ–°å¢æ—¶è°ƒç”¨ï¼‰
    c: {
      method: 'POST',
    },
    // æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼ˆopenForm åœ¨æŸ¥çœ‹ã€ç¼–è¾‘æ—¶è°ƒç”¨ï¼‰
    r: {
      method: 'GET',
    },
    // ç¼–è¾‘ä¸€æ¡è®°å½•ï¼ˆsubmitForm åœ¨ç¼–è¾‘æ—¶è°ƒç”¨ï¼‰
    u: {
      method: 'PUT',
    },
    // åˆ é™¤ä¸€æ¡è®°å½•
    d: {
      method: 'DELETE',
    },
    // å¯ç”¨ä¸€æ¡è®°å½•
    enable: {
      method: 'PUT',
    },
    // ç¦ç”¨ä¸€æ¡è®°å½•
    disable: {
      method: 'PUT',
    },
    // å˜æ›´ä¸€æ¡è®°å½•çš„çŠ¶æ€
    updateStatus: {
      method: 'PUT',
    },
  },
})
```

<br>

### urlPrefix

```ts
useAdmate({
  // axiosConfig ä¸­å„ä¸ªæ¥å£çš„ URL å‰ç¼€
  urlPrefix: '',
})
```

```ts
// ç¤ºä¾‹ï¼šURL å‰ç¼€ä¸ç»Ÿä¸€

useAdmate({
  urlPrefix: 'somepage',
  axiosConfig: {
    r: {
      // å¦‚æœæŸä¸ªæ¥å£çš„å‰ç¼€ä¸æ˜¯ 'somepage'ï¼Œå¯ä»¥åœ¨ URL å‰é¢åŠ æ–œçº¿ï¼Œå³å¯å¿½ç•¥è¯¥å‰ç¼€
      url: '/anotherpage/selectOne',
    },
  }
})
```

<br>

### RESTful

å¦‚æœæ¥å£åœ°å€éœ€è¦è¿›è¡ŒåŠ¨æ€æ‹¼æ¥

```ts
<!-- ç¤ºä¾‹ -->

// é…ç½®
const { openForm, d, enable, disable, updateStatus } = useAdmate({
  axiosConfig: {
    // æŸ¥è¯¢åˆ—è¡¨
    getList: payload => ({
      method: 'GET',
      url: 'module/' + payload.xxx
    }),
    // æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼ˆopenForm åœ¨æŸ¥çœ‹ã€ç¼–è¾‘æ—¶è°ƒç”¨ï¼‰
    r: payload => ({
      method: 'GET',
      url: 'module/' + payload.id
    }),
    // ç¼–è¾‘ä¸€æ¡è®°å½•ï¼ˆsubmitForm åœ¨ç¼–è¾‘æ—¶è°ƒç”¨ï¼‰
    u: payload => ({
      method: 'PUT',
      url: 'module/' + payload.id
    }),
    // åˆ é™¤ä¸€æ¡è®°å½•
    d: payload => ({
      method: 'DELETE',
      url: 'module/' + payload.id
    }),
    // å¯ç”¨ä¸€æ¡è®°å½•
    enable: payload => ({
      method: 'PUT',
      url: 'module/' + payload.id
    }),
    // ç¦ç”¨ä¸€æ¡è®°å½•
    disable: payload => ({
      method: 'PUT',
      url: 'module/' + payload.id
    }),
    // å˜æ›´ä¸€æ¡è®°å½•çš„çŠ¶æ€
    updateStatus: payload => ({
      method: 'PUT',
      url: 'module/' + payload.id
    }),
  }
})

// ä½¿ç”¨
openForm({ id: 1 }, 'config')
d({ id: 1 }, 'config')
enable({ id: 1 }, 'config')
disable({ id: 1 }, 'config')
updateStatus({ id: 1 }, 'config')
```

<br>

### FormData

Axios çš„ data é»˜è®¤ä»¥ `application/json` ä½œä¸º MIME typeï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨ `multipart/form-data`ï¼š

- å…¨å±€é…ç½®

ç»™ä½ çš„ Axios é…ç½® `transformRequest`ã€`headers['Content-Type']`

- å±€éƒ¨é…ç½®

`getList`ã€`openForm`ã€`d`ã€`updateStatus`ã€`enable`ã€`disable`ã€`submitForm` çš„å‚æ•° 1 å‡æ”¯æŒ FormData ç±»å‹

```vue
<!-- ç¤ºä¾‹ï¼šå±€éƒ¨é…ç½® -->

<template>
  <el-table>
    <el-table-column label="æ“ä½œ">
      <template #default="{ row: { id } }">
        <el-button @click="r(FormData.from({ id }))">æŸ¥çœ‹</el-button>
        <el-button @click="u(FormData.from({ id }))">ç¼–è¾‘</el-button>
        <el-button @click="d(FormData.from({ id }))">åˆ é™¤</el-button>
      </template>
    </el-table-column>
  </el-table>

  <el-dialog>
    <template #footer>
      <el-button @click="submitForm(FormData.from( form.data ))">
        ç¡® å®š
      </el-button>
    </template>
  </el-dialog>
</template>

<script>
import useAdmate from 'admate'
import { jsonToFormData, pickDeepBy } from 'kayran'

export default {
  setup: () => {
    // è¿‡æ»¤å‚æ•°å¹¶è½¬æ¢ä¸º FormData
    // æ­¤å¤„ç¤ºä¾‹ä¸ºå°†è¿‡æ»¤æ–¹æ³•ç»‘å®šåˆ° window.FormDataï¼Œæ–¹ä¾¿å…¶ä»–åœ°æ–¹ä½¿ç”¨
    FormData.from = data => jsonToFormData(pickDeepBy(data, (v, k) => ![NaN, null, undefined].includes(v)))

    // ç›´æ¥è½¬æ¢ä¸º FormData
    //FormData.from = jsonToFormData

    const admate = useAdmate({
      getListProxy (getList, trigger) {
        getList(FormData.from(list.filter))
      },
    })
    
    return {
      ...admate,
      r: (...args) => {
        admate.form.status = 'r'
        admate.openForm(...args)
      },
      u: (...args) => {
        admate.form.status = 'u'
        admate.openForm(...args)
      },
      FormData
    }
  }
}
</script>
```

<br>

## åˆ—è¡¨

### ç­›é€‰å‚æ•°

`list.filter`

```ts
useAdmate({
  list: {
    // å¯ä»¥åœ¨è¿™é‡Œæä¾›ç­›é€‰å‚æ•°çš„é»˜è®¤å€¼
    filter: {
      [list.pageNumberKey]: 1,
    },

    // å¿…å¡«
    // é¡µç çš„å‚æ•°å
    pageNumberKey: undefined,
  },
})
```

å¦‚æœä½ çš„å‚æ•°ç­›é€‰é¡¹ä¸­åŒ…å« `el-checkbox` ç»„ä»¶ï¼Œåˆ™å¿…é¡»åœ¨ data ä¸­å£°æ˜å…¶åˆå§‹å€¼ï¼Œå¦åˆ™å°†å¯¼è‡´æ— æ³•æ­£ç¡®é‡ç½®ï¼ˆelement-ui çš„ Bugï¼‰

```vue
<!-- ç¤ºä¾‹ -->

<template>
  <el-form ref="listFilterRef" :model="list.filter" inline>
    <el-form-item prop="effect">
      <el-checkbox
        v-model="list.filter.effect"
        label="ç”Ÿæ•ˆ"
        border
      />
    </el-form-item>
    <el-button @click="reset">é‡ç½®</el-button>
  </el-form>
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => useAdmate({
    urlPrefix: '',
    list: {
      filter: {
        effect: null
      }
    }
  }),
}
</script>
```

<br>

### è§¦å‘æŸ¥è¯¢

- ç‚¹å‡»ä¸“ç”¨çš„æŸ¥è¯¢æŒ‰é’®è§¦å‘
    - :x: æ“ä½œç›¸å¯¹ç¹çã€‚
    - :x: åˆ—è¡¨æ•°æ®ä¸ç­›é€‰æ¡ä»¶å¯èƒ½æ˜¯æ— å…³çš„ã€‚å¯èƒ½äº§ç”Ÿâ€œå½“å‰çš„åˆ—è¡¨æ•°æ®æ˜¯å¦åŸºäºç­›é€‰é¡¹ï¼Ÿâ€çš„é¡¾è™‘ï¼Œå¯¼è‡´å¾’å¢ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®çš„æ¬¡æ•°ã€‚
    - :heavy_check_mark: æƒ³åŒæ—¶è®¾ç½®å¤šä¸ªç­›é€‰æ¡ä»¶æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡æ¥å£ï¼Œä¸ä¼šé€ æˆèµ„æºæµªè´¹ã€‚

```ts
useAdmate({
  list: {
    watchFilter: false,
  }
})
```

<hr>

- **æ”¹å˜ç­›é€‰æ¡ä»¶åå³æ—¶è§¦å‘**
    - :heavy_check_mark: æ“ä½œç›¸å¯¹ç®€ä¾¿ã€‚
    - :heavy_check_mark: åˆ—è¡¨æ•°æ®ä¸ç­›é€‰æ¡ä»¶å³æ—¶ç»‘å®šã€‚
    - :heavy_check_mark: ~~æƒ³åŒæ—¶è®¾ç½®å¤šä¸ªç­›é€‰æ¡ä»¶æ—¶ï¼Œæ¥å£ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œé€ æˆèµ„æºæµªè´¹~~ï¼ˆAdmate å·²ä¼˜åŒ–ï¼‰ã€‚

```ts
useAdmate({
  list: {
    watchFilter: true, // é»˜è®¤å€¼

    // é˜²æŠ–é—´éš”ï¼Œå•ä½æ¯«ç§’
    // å¦‚æœç­›é€‰å‚æ•°ä¸å« input ç±»å‹ï¼Œå¯ä»¥è®¾ç½®ä¸º 0ï¼Œå³ä¸é˜²æŠ–
    // ç¿»é¡µä¸ä¼šè§¦å‘é˜²æŠ–
    // watchFilter å¼€å¯æ—¶æœ‰æ•ˆ
    debounceInterval: 300, // é»˜è®¤å€¼
  }
})
```

<br>

### åˆ—è¡¨æ•°æ®

`list.data`

```ts
useAdmate({
  list: {
    // åˆ—è¡¨æ•°æ®
    data: [],

    // æŒ‡å®šæ¥å£è¿”å›å€¼ä¸­åˆ—è¡¨æ•°æ®æ‰€åœ¨çš„ä½ç½®
    // æ”¯æŒå±æ€§åå¦‚ 'data'ï¼Œå±æ€§è·¯å¾„å¦‚ 'data.records'
    // è¿˜æ”¯æŒ functionï¼Œå¦‚ response => response.data
    dataAt: undefined,

    // æŒ‡å®šæ¥å£è¿”å›å€¼ä¸­è®°å½•æ€»æ•°æ‰€åœ¨çš„ä½ç½®
    // æ”¯æŒå±æ€§åå¦‚ 'total'ï¼Œå±æ€§è·¯å¾„å¦‚ 'data.total'
    // è¿˜æ”¯æŒ functionï¼Œå¦‚ response => response.total + 1
    totalAt: undefined,
  }
})
```

<br>

### è¯»å–çŠ¶æ€

`list.loading`

`axiosConfig.getList` è¢«è°ƒç”¨æ—¶å€¼ä¸º `true`ï¼Œå¦åˆ™ä¸º `false`

```vue
<!-- ç¤ºä¾‹ -->

<template>
  <el-table v-loading="list.loading"/>
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => {
    const { list } = useAdmate()
    return { list }
  },
  methods: {
    handleTable () {
      this.list.loading = true
      this.$POST('').finally(() => {
        this.list.loading = false
      })
    }
  }
}
</script>
```

<br>

### Hook: æŸ¥è¯¢åˆ—è¡¨æ—¶

`getList` ï¼šè·å–åˆ—è¡¨ï¼Œåœ¨é¦–æ¬¡è¿›å…¥é¡µé¢ã€åˆ—è¡¨ç­›é€‰å‚æ•°æ”¹å˜ã€å•æ¡è®°å½•å¢åˆ æŸ¥æ”¹åä¼šè¢«è°ƒç”¨

```ts
const {
  /**
   * PSï¼šä»¥ä¸‹ä¸ºåŸå§‹ getList çš„å‡½æ•°ç­¾åï¼Œå¦‚æœä½ é…ç½®äº† getListProxyï¼Œåˆ™ä»¥ getListProxy ä¸ºå‡†
   *
   * @param {any} [payload = list.filter]
   * @param {'data'|'params'|'config'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
   * @returns {Promise<any>} æ¥å£è¿”å›å€¼
   */
  getList
} = useAdmate()

getList() // æ‰‹åŠ¨æŸ¥è¯¢
```

`getListProxy`ï¼šä½ å¯ä»¥ä½¿ç”¨ `getListProxy` æ¥ä»£ç† `getList`ï¼Œä»¥ä¾¿åœ¨ getList å‰ååšä¸€äº›æ“ä½œï¼Œæˆ–æ”¹å˜ getList çš„è¡Œä¸º

```ts
useAdmate({
  /**
   * @param {Function} getList è¢«ä»£ç†çš„åŸå§‹ getList
   * @param {string} trigger è°ƒç”¨åŠ¨æœº å¯èƒ½çš„å€¼ï¼š'init' 'pageNumberChange' 'filterChange' 'c' 'r' 'u' 'd' 'updateStatus' 'enable' 'disable'
   */
  getListProxy (getList, trigger) {},
})
```

```ts
// ç¤ºä¾‹ï¼šè·å–åˆ—è¡¨ä¹‹å‰ï¼Œæ ¡éªŒå‚æ•°

useAdmate({
  getListProxy (getList, trigger) {
    if (trigger === 'filterChange') {
      listFilterRef.value.validate().then(() => {
        getList()
      })
    } else {
      getList()
    }
  },
})
```

```ts
// ç¤ºä¾‹ï¼šå•æ¡è®°å½•æ“ä½œæˆåŠŸåï¼Œå¼¹å‡ºæç¤º

useAdmate({
  getListProxy (getList, trigger) {
    getList()
    if (['c', 'u', 'd', 'updateStatus', 'enable', 'disable'].includes(trigger)) {
      currentInstance.value.$message.success('æ“ä½œæˆåŠŸ')
    }
  },
})
```

```ts
// ç¤ºä¾‹ï¼šè·å–åˆ—è¡¨åï¼Œä¿®æ”¹åˆ—è¡¨æ•°æ®

const { list } = useAdmate({
  getListProxy (getList, trigger) {
    getList().then(response => {
      // response ä¸º axiosConfig.getList çš„æ¥å£è¿”å›å€¼
      list.data = response.data?.filter(v => !v.disabled)
    })
  },
})
```

<a class="anchor-fix" name="openForm-c"></a>

<br>

## è¡¨å•

### æ–°å¢

æ‰“å¼€è¡¨å•ï¼Œæäº¤æ—¶ä¼šè°ƒç”¨ `axiosConfig.c`

```ts
const { form, openForm } = useAdmate()

// å°†è¡¨å•å½¢æ€è®¾ç½®ä¸ºâ€œæ–°å¢â€ï¼Œç„¶åæ‰“å¼€è¡¨å•
form.status = 'c'
openForm()
```

<a class="anchor-fix" name="openForm-r"></a>

<br>

### æŸ¥çœ‹

æ‰“å¼€è¡¨å•ï¼Œå¹¶è°ƒç”¨ `axiosConfig.r` å›æ˜¾è¡¨å•å†…å®¹

```ts
const { form, openForm } = useAdmate()

// å°†è¡¨å•å½¢æ€è®¾ç½®ä¸ºâ€œæŸ¥çœ‹â€ï¼Œç„¶åæ‰“å¼€è¡¨å•
form.status = 'r'
/**
 * PSï¼šä»¥ä¸‹ä¸ºåŸå§‹ openForm çš„å‡½æ•°ç­¾åï¼Œå¦‚æœä½ é…ç½®äº† openFormProxy ï¼Œåˆ™ä»¥ openFormProxy ä¸ºå‡†
 *
 * @param {any} [payload] å¦‚æœ payload ä¸ä¸ºç©ºï¼Œåˆ™ä¼šè°ƒç”¨ axiosConfig.r
 * @param {'data'|'params'|'config'|'cache'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
 *   'data': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `data` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º POST / PATCH / PUT / DELETE æ—¶é»˜è®¤ï¼‰
 *   'params': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `params` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º GET / HEAD æ—¶é»˜è®¤ï¼‰
 *   'config': å°† payload ä»…ç”¨äºæ„å»ºè¯·æ±‚é…ç½®ï¼ˆè¯¦è§ RESTful ç« èŠ‚ï¼‰
 *   'cache': å°† payload ç›´æ¥ç”¨ä½œè¡¨å•æ•°æ®ï¼ˆä¸è°ƒç”¨æŸ¥è¯¢å•æ¡è®°å½•çš„æ¥å£ï¼‰
 * @returns {Promise<any>} axiosConfig.r çš„è¿”å›å€¼
 */
openForm()
```

<a class="anchor-fix" name="openForm-u"></a>

<br>

### ç¼–è¾‘

æ‰“å¼€è¡¨å•ï¼Œå¹¶è°ƒç”¨ `axiosConfig.r` å›æ˜¾è¡¨å•å†…å®¹ï¼Œæäº¤æ—¶ä¼šè°ƒç”¨ `axiosConfig.u`

```ts
const { form, openForm } = useAdmate()

// å°†è¡¨å•å½¢æ€è®¾ç½®ä¸ºâ€œç¼–è¾‘â€ï¼Œç„¶åæ‰“å¼€è¡¨å•
form.status = 'u'
/**
 * PSï¼šä»¥ä¸‹ä¸ºåŸå§‹ openForm çš„å‡½æ•°ç­¾åï¼Œå¦‚æœä½ é…ç½®äº† openFormProxyï¼Œåˆ™ä»¥ openFormProxy ä¸ºå‡†
 *
 * @param {any} [payload] å¦‚æœ payload ä¸ä¸ºç©ºï¼Œåˆ™ä¼šè°ƒç”¨ axiosConfig.r
 * @param {'data'|'params'|'config'|'cache'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
 *   'data': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `data` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º POST / PATCH / PUT / DELETE æ—¶é»˜è®¤ï¼‰
 *   'params': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `params` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º GET / HEAD æ—¶é»˜è®¤ï¼‰
 *   'config': å°† payload ä»…ç”¨äºæ„å»ºè¯·æ±‚é…ç½®ï¼ˆè¯¦è§ RESTful ç« èŠ‚ï¼‰
 *   'cache': å°† payload ç›´æ¥ç”¨ä½œè¡¨å•æ•°æ®ï¼ˆä¸è°ƒç”¨æŸ¥è¯¢å•æ¡è®°å½•çš„æ¥å£ï¼‰
 * @returns {Promise<any>} axiosConfig.r çš„è¿”å›å€¼
 */
openForm()
```

<br>

### åˆ é™¤

```ts
const {
  /**
   * @param {any} [payload]
   * @param {'data'|'params'|'config'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
   *   'data': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `data` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º POST / PATCH / PUT / DELETE æ—¶é»˜è®¤ï¼‰
   *   'params': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `params` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º GET / HEAD æ—¶é»˜è®¤ï¼‰
   *   'config': å°† payload ä»…ç”¨äºæ„å»ºè¯·æ±‚é…ç½®ï¼ˆè¯¦è§ RESTful ç« èŠ‚ï¼‰
   * @returns {Promise<any>} axiosConfig.d çš„è¿”å›å€¼
   */
  d
} = useAdmate()
```

<br>

### çŠ¶æ€å˜æ›´

çŠ¶æ€å˜æ›´æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. åç«¯åªæä¾›ä¸€ä¸ªæ¥å£ï¼Œä¼ å‚æŒ‡å®šæ–°çš„çŠ¶æ€
2. åç«¯æä¾›å¯ç”¨å’Œåœç”¨ä¸¤ä¸ªæ¥å£

```vue
<!-- æ–¹å¼ä¸€ï¼šä½¿ç”¨ updateStatus -->

<template>
  <el-table>
    <el-table-column label="æ“ä½œ" align="center">
      <template slot-scope="{ row: { id, status } }">
        <el-switch @change="updateStatus({ id, status: status^1 })"/>
      </template>
    </el-table-column>
  </el-table>
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => {
    const {
      /**
       * @param {any} [payload]
       * @param {'data'|'params'|'config'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
       *   'data': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `data` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º POST / PATCH / PUT / DELETE æ—¶é»˜è®¤ï¼‰
       *   'params': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `params` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º GET / HEAD æ—¶é»˜è®¤ï¼‰
       *   'config': å°† payload ä»…ç”¨äºæ„å»ºè¯·æ±‚é…ç½®ï¼ˆè¯¦è§ RESTful ç« èŠ‚ï¼‰
       * @returns {Promise<any>} axiosConfig.updateStatus çš„è¿”å›å€¼
       */
      updateStatus,
    } = useAdmate()
    return { updateStatus }
  }
}
</script>
```

```vue
<!-- æ–¹å¼äºŒï¼šä½¿ç”¨ enable å’Œ disable -->

<template>
  <el-table>
    <el-table-column label="æ“ä½œ" align="center">
      <template slot-scope="{ row: { id, status } }">
        <el-switch @change="[enable,disable][status]({id})"/>
      </template>
    </el-table-column>
  </el-table>
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => {
    const {
      /**
       * @param {any} [payload]
       * @param {'data'|'params'|'config'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
       *   'data': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `data` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º POST / PATCH / PUT / DELETE æ—¶é»˜è®¤ï¼‰
       *   'params': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `params` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º GET / HEAD æ—¶é»˜è®¤ï¼‰
       *   'config': å°† payload ä»…ç”¨äºæ„å»ºè¯·æ±‚é…ç½®ï¼ˆè¯¦è§ RESTful ç« èŠ‚ï¼‰
       * @returns {Promise<any>} axiosConfig.enable çš„è¿”å›å€¼
       */
      enable,

      /**
       * @param {any} [payload]
       * @param {'data'|'params'|'config'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
       *   'data': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `data` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º POST / PATCH / PUT / DELETE æ—¶é»˜è®¤ï¼‰
       *   'params': å°† payload ç”¨ä½œè¯·æ±‚é…ç½®çš„ `params` å‚æ•°ï¼ˆè¯·æ±‚æ–¹å¼ä¸º GET / HEAD æ—¶é»˜è®¤ï¼‰
       *   'config': å°† payload ä»…ç”¨äºæ„å»ºè¯·æ±‚é…ç½®ï¼ˆè¯¦è§ RESTful ç« èŠ‚ï¼‰
       * @returns {Promise<any>} axiosConfig.disable çš„è¿”å›å€¼
       */
      disable
    } = useAdmate()
    return { enable, disable }
  }
}
</script>
```

<br>

### è¡¨å•æ•°æ®

`form.data`

```ts
useAdmate({
  form: {
    // å¯ä»¥åœ¨è¿™é‡Œæä¾›è¡¨å•æ•°æ®çš„é»˜è®¤å€¼
    data: {},

    // åœ¨æŸ¥çœ‹ã€ç¼–è¾‘è¡¨å•æ—¶ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨æ¥å£ï¼ˆaxiosConfig.rï¼‰å›æ˜¾è¡¨å•çš„æ•°æ®
    // dataAt ç”¨äºæŒ‡å®šæ¥å£è¿”å›å€¼ä¸­è¡¨å•æ•°æ®æ‰€åœ¨çš„ä½ç½®
    // æ”¯æŒå±æ€§åå¦‚ 'data'ï¼Œå±æ€§è·¯å¾„å¦‚ 'data.detail'
    // è¿˜æ”¯æŒ functionï¼Œå¦‚ response => response.data
    dataAt: undefined,

    // æ¥å£ï¼ˆaxiosConfig.rï¼‰è¿”å›å€¼ä¸ form.data åˆå¹¶çš„æ–¹å¼
    mergeData: 'deep',
  },
})
```

**mergeData:**

- `'deep'`: æ·±åˆå¹¶ï¼ˆé»˜è®¤ï¼‰
- `'shallow'`: æµ…åˆå¹¶
- `(newFormData: any) => any`: è‡ªå®šä¹‰åˆå¹¶æ–¹å¼
- `false`: ä¸åˆå¹¶ï¼Œç›´æ¥æ›¿æ¢

**ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯æ·±åˆå¹¶ï¼Ÿ**

åœ¨ Vue 2 ä¸­ï¼Œtemplate ä¸æ”¯æŒ `?.` è¯­æ³•ï¼Œè¦åœ¨ template ä¸­åˆ¤ç©ºï¼Œä»£ç å†™èµ·æ¥ä¼šéå¸¸å†—ä½™ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨ data ä¸­å£°æ˜ç©ºå¯¹è±¡

æ¯”å¦‚ç»™ form.data æä¾›é»˜è®¤å€¼ï¼š

```vue

<template>
  {{ form.data.a.b.c }}
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => {
    const { form } = useAdmate({
      form: {
        data: {
          a: {
            b: {}
          }
        }
      }
    })
    return { form }
  }
}
</script>
```

å¦‚æœ axiosConfig.r çš„è¿”å›å€¼ä¸ºï¼š
`{ a: {} }`

å¦‚æœä¸é»˜è®¤å€¼<span style="color:red">æµ…åˆå¹¶</span>åå°†å¾—åˆ°ï¼š
`{ a: {} }` â€”â€” é»˜è®¤å€¼ä¸­çš„å¯¹è±¡bä¸¢å¤±äº†ï¼Œå¼•å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

å¦‚æœä¸é»˜è®¤å€¼<span style="color:red">æ·±åˆå¹¶</span>åå°†å¾—åˆ°ï¼š
`{ a: { b: {} } }` â€”â€” ä»£ç æ­£å¸¸å·¥ä½œã€‚

```ts
// ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åˆå¹¶æ–¹å¼

import { mergeWith } from 'lodash'

const defaultFormData = () => ({
  a: {
    b: {}
  }
})

const { form } = useAdmate({
  form: {
    data: defaultFormData(),
    // æ¥å£è¿”å›å€¼ä¸­åµŒå¥—çš„å¯¹è±¡å¯èƒ½ä¸º nullï¼Œä¼šè¦†ç›–é»˜è®¤å€¼ä¸­çš„ç©ºå¯¹è±¡
    mergeData (
      // æ¥å£è¿”å›å€¼åœ¨é€šè¿‡ form.dataAt è®¡ç®—è¿‡åçš„å€¼
      newFormData
    ) {
      // Vue 3 ä¸­ä¸éœ€è¦èµ‹å€¼ï¼ŒmergeWith çš„æ”¹åŠ¨æ˜¯å“åº”å¼çš„
      form.data = mergeWith(
        defaultFormData(),
        newFormData,
        (oldObj, newObj) => [undefined, null].includes(newObj) ? oldObj : undefined
      )
    },
  },
})
```

<br>

### è¡¨å•å½¢æ€

#### è¡¨å•å½¢å¼

è¡¨å•é»˜è®¤æ˜¯å¯¹è¯æ¡†çš„å½¢å¼ï¼Œä½†ä¹Ÿæ”¯æŒ[è¡¨å•æ˜¯ç‹¬ç«‹é¡µé¢](#FormDecoupled) çš„æƒ…å†µ

å¯¹æ¯”

- å¯¹è¯æ¡†ï¼šä½“éªŒå¥½ï¼Œå‰²è£‚æ„Ÿä½ï¼Œè¡¨å•çš„å¼€é—­ä¸å½±å“çˆ¶é¡µé¢çŠ¶æ€
- ç‹¬ç«‹é¡µé¢ï¼šä½“éªŒè¾ƒå·®ï¼Œä»è¡¨å•è¿”å›çˆ¶é¡µé¢æ—¶ï¼Œçˆ¶é¡µé¢çš„çŠ¶æ€ä¼šä¸¢å¤±ï¼Œæ¯”å¦‚åˆ—è¡¨ç­›é€‰çŠ¶æ€

<hr>

#### `form.show`

è¡¨å•æ˜¯å¦æ‰“å¼€

```ts
// ç±»å‹

boolean
```

<hr>

#### `form.status`

è¡¨å•çš„å½¢æ€

```ts
// ç±»å‹

type StatusType = '' | 'c' | 'r' | 'u' | string

// åˆ†åˆ«è¡¨ç¤ºå…³é—­ã€æ–°å¢ã€æŸ¥çœ‹ã€ç¼–è¾‘ã€è‡ªå®šä¹‰
```

`form.show` ä¸º `false` æ—¶ï¼Œ`form.status` ä¸º `''`

<hr>

#### äº¤å‰å½¢æ€

æ¯”å¦‚â€œå¤åˆ¶æ–°å¢â€ï¼šè¡¨å•çš„åˆå§‹æ•°æ®ä¸æ˜¯ç©ºç™½ï¼Œè€Œæ˜¯å¤åˆ¶ä¸€æ¡å·²æœ‰çš„è®°å½•ã€‚

1. æ‰“å¼€è¡¨å•æ—¶ï¼Œå’ŒæŸ¥çœ‹/ç¼–è¾‘ä¸€æ ·ï¼Œéœ€è¦è°ƒæ¥å£å›æ˜¾
2. è°ƒç”¨çš„æ¥å£æ˜¯æ–°å¢çš„æ¥å£
3. è¡¨å•åç§°æ˜¾ç¤ºä¸ºâ€œå¤åˆ¶æ–°å¢â€

å¯¹äºè¿™ç§éœ€æ±‚ï¼Œæ²¡æœ‰å¿…è¦ä¸“é—¨å¢åŠ ä¸€ç§è¡¨å•å½¢æ€ï¼Œå¯ä»¥å€ŸåŠ©ä¸€ä¸ªè¾…åŠ©å˜é‡å¦‚ `isCopy`ï¼Œç”¨ `isCopy && form.status ==='c'` æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å¤åˆ¶æ–°å¢ï¼Œç„¶åç»™ `openForm` ä¼ å‚å³å¯å›æ˜¾ã€‚

<br>

### è¯»å–çŠ¶æ€

`form.loading`

`axiosConfig.r` è¢«è°ƒç”¨æ—¶å€¼ä¸º `true`ï¼Œå¦åˆ™ä¸º `false`

> ä¸èƒ½å°†è¯¥å€¼å½“ä½œè¡¨å•å›æ˜¾ç»“æŸçš„æ ‡å¿—ï¼Œå› ä¸ºå¤ç”¨åˆ—è¡¨æ•°æ®æ—¶ä¸ä¼šè°ƒç”¨ axiosConfig.r

```vue
<!-- ç¤ºä¾‹ -->

<template>
  <el-dialog>
    <el-form v-loading="form.loading"/>
  </el-dialog>
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => {
    const { form } = useAdmate()
    return { form }
  }
}
</script>
```

<br>

### æäº¤çŠ¶æ€

`form.submitting`

`axiosConfig.c` æˆ– `axiosConfig.u` è¢«è°ƒç”¨æ—¶å€¼ä¸º `true`ï¼Œå¦åˆ™ä¸º `false`

```vue
<!-- ç¤ºä¾‹ -->

<template>
  <el-dialog>
    <template #footer>
      <el-button :loading="form.submitting">
        ç¡® å®š
      </el-button>
    </template>
  </el-dialog>
</template>

<script>
import useAdmate from 'admate'

export default {
  setup: () => {
    const { form } = useAdmate()
    return { form }
  }
}
</script>
```

<br>

### Hook: æ‰“å¼€è¡¨å•æ—¶

`openForm` ï¼šæ‰“å¼€è¡¨å•ï¼Œå‡½æ•°ç­¾åè¦åˆ†æƒ…å†µï¼š

- [æ–°å¢æ—¶](#openForm-c)
- [æŸ¥çœ‹æ—¶](#openForm-r)
- [ç¼–è¾‘æ—¶](#openForm-u)

`openFormProxy`ï¼šä½ å¯ä»¥ä½¿ç”¨ `openFormProxy` æ¥ä»£ç† `openForm`ï¼Œä»¥ä¾¿åœ¨ openForm å‰ååšä¸€äº›æ“ä½œï¼Œæˆ–æ”¹å˜ openForm çš„è¡Œä¸º

```ts
useAdmate({
  /**
   * @param {Function} openForm è¢«ä»£ç†çš„åŸå§‹ openForm
   * @returns {Promise<object> | object | void} object ä¸ºæ‰“å¼€è¡¨å•å form çš„ç»ˆæ€
   */
  openFormProxy (openForm) {},
})
```

<hr>

```ts
// ç¤ºä¾‹ï¼šå›æ˜¾è¡¨å•åï¼Œä¿®æ”¹è¡¨å•æ•°æ®

const { form } = useAdmate({
  openFormProxy (openForm) {
    // æ–°å¢æ—¶ openForm æ²¡æœ‰è¿”å›å€¼
    return new Promise((resolve, reject) => {
      openForm()?.then(response => {
        // response ä¸º axiosConfig.r çš„æ¥å£è¿”å›å€¼
        // ä¿®æ”¹è¡¨å•æ•°æ®
        form.data.status = 1
        resolve()
      }).catch(() => {
        reject()
      })
    })
  },
})
```

```ts
// ç¤ºä¾‹ï¼šå›æ˜¾è¡¨å•åï¼Œæ¸…é™¤æ ¡éªŒ

useAdmate({
  openFormProxy (openForm) {
    return new Promise((resolve, reject) => {
      openForm()?.finally(() => {
        formRef.value.clearValidate()
      }).then(() => {
        resolve()
      }).catch(() => {
        reject()
      })
    })
  },
})
```

```ts
// ç¤ºä¾‹ï¼šå›æ˜¾è¡¨å•åï¼Œè‡ªå®šä¹‰è¡¨å•çš„å¼€é—­å’Œè¯»å–çŠ¶æ€
useAdmate({
  openFormProxy (openForm) {
    return new Promise((resolve, reject) => {
      // å¯ä»¥åœ¨ finally ä¸­ resolve
      openForm().then(() => {
        // å›æ˜¾æˆåŠŸåï¼Œé»˜è®¤åœæ­¢åŠ è½½
        resolve({
          loading: false,
        })
      }).catch(() => {
        // å›æ˜¾å¤±è´¥åï¼Œé»˜è®¤å…³é—­è¡¨å•å¹¶åœæ­¢åŠ è½½
        reject({
          show: false,
          loading: false,
        })
      })
    })
  }
})

// ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆå¦‚æœæ²¡æœ‰å¼‚æ­¥æ“ä½œï¼‰
useAdmate({
  openFormProxy (openForm) {
    return {
      loading: false
    }
  }
})
```

<br>

### Hook: æäº¤è¡¨å•æ—¶

`submitForm` ï¼šæäº¤è¡¨å•ï¼Œæ–°å¢æ—¶è°ƒç”¨ `axiosConfig.c`ï¼Œç¼–è¾‘æ—¶è°ƒç”¨ `axiosConfig.u`

```ts
const {
  /**
   * PSï¼šä»¥ä¸‹ä¸ºåŸå§‹ submitForm çš„å‡½æ•°ç­¾åï¼Œå¦‚æœä½ é…ç½®äº† submitFormProxy ï¼Œåˆ™ä»¥ submitFormProxy ä¸ºå‡†
   *
   * @param {any} [payload = form.data]
   * @param {'data'|'params'|'config'} [payloadAs] æŒ‡å®š payload çš„ç”¨é€”
   * @returns {Promise<any>} æ¥å£è¿”å›å€¼
   */
  submitForm
} = useAdmate()
```

`submitFormProxy`ï¼šä½ å¯ä»¥ä½¿ç”¨ `submitFormProxy` æ¥ä»£ç† `submitForm`ï¼Œä»¥ä¾¿åœ¨ submitForm å‰ååšä¸€äº›æ“ä½œï¼Œæˆ–æ”¹å˜submitFormçš„è¡Œä¸º

```ts
useAdmate({
  /**
   * @param {Function} submitForm è¢«ä»£ç†çš„åŸå§‹ submitForm
   * @returns {Promise<object> | object | void} object ä¸ºæäº¤è¡¨å•å form çš„ç»ˆæ€
   */
  submitFormProxy (submitForm) {}
})
```

<hr>

```ts
// ç¤ºä¾‹ï¼šæŒ‡å®šæäº¤å‚æ•°

submitForm({
  ...form.data,
  status: 1,
})

// submitForm è¢«ä»£ç†æ—¶
useAdmate({
  submitFormProxy (submitForm) {
    return new Promise((resolve, reject) => {
      submitForm({
        ...form.data,
        status: 1,
      }).then(() => {
        resolve()
      }).catch(() => {
        reject()
      })
    })
  }
})
```

```ts
// ç¤ºä¾‹ï¼šæäº¤å‰æ ¡éªŒè¡¨å•

useAdmate({
  submitFormProxy (submitForm) {
    return new Promise((resolve, reject) => {
      formRef.value.validate().then(() => {
        submitForm().then(() => {
          resolve()
        }).catch(() => {
          reject()
        })
      })
    })
  }
})
```

```ts
// ç¤ºä¾‹ï¼šæäº¤è¡¨å•åï¼Œè‡ªå®šä¹‰è¡¨å•çš„å¼€é—­å’Œæäº¤çŠ¶æ€

// è¿”å›ä¸€ä¸ª promise
useAdmate({
  submitFormProxy (submitForm) {
    return new Promise((resolve, reject) => {
      formRef.value.validate().then(() => {
        submitForm().then(() => {
          // æäº¤æˆåŠŸåï¼Œé»˜è®¤å…³é—­è¡¨å•ï¼Œå¹¶åœæ­¢åŠ è½½
          resolve({
            show: false,
            submitting: false,
          })
        }).catch(() => {
          // æäº¤å¤±è´¥åï¼Œé»˜è®¤ä»…åœæ­¢åŠ è½½
          reject({
            show: true,
            submitting: false,
          })
        })
      })
    })
  }
})

// ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆå¦‚æœæ²¡æœ‰å¼‚æ­¥æ“ä½œï¼‰
useAdmate({
  submitFormProxy (submitForm) {
    return {
      show: false,
      submitting: false,
    }
  }
})
```

<br>

## ç¤ºä¾‹ï¼šè¡¨å•æ˜¯å­ç»„ä»¶

å°†è¡¨å•æŠ½ç¦»ä¸ºå­ç»„ä»¶

[ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/examples/FormExternalized.vue)

<a class="anchor-fix" name="FormDecoupled"></a>

<br>

## ç¤ºä¾‹ï¼šè¡¨å•æ˜¯ç‹¬ç«‹é¡µé¢

æ“ä½œå•æ¡è®°å½•æ—¶ï¼Œè·³è½¬åˆ°ä¸“ç”¨çš„è¡¨å•é¡µé¢ï¼Œæ“ä½œå®Œæ¯•åè¿”å›

[ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/examples/FormDecoupled.vue)

<br>

## ç¤ºä¾‹ï¼šåªæœ‰è¡¨å•æ²¡æœ‰åˆ—è¡¨

è¡¨å•é»˜è®¤æ‰“å¼€ï¼Œä¸”æ— æ³•å…³é—­ï¼Œé€šå¸¸ç”¨äºåˆ—è¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œæ•…åˆ—è¡¨è¢«çœç•¥çš„åœºæ™¯

[ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/examples/FormOnly.vue)

<br>

## ç¤ºä¾‹ï¼šåµŒå¥—ä½¿ç”¨

åµŒå¥—å…¶å®ƒä¹Ÿä½¿ç”¨ Admate çš„é¡µé¢

[ç¤ºä¾‹](https://github.com/cloydlau/admate/blob/master/demo/vue3/examples/Nested.vue)

<br>

![Alt](https://repobeats.axiom.co/api/embed/96d9b8e4c191488faaa6e4545b684afd114c6cdd.svg "Repobeats analytics image")
